# ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

**–î–∞—Ç–∞**: 2025-10-16
**–í—Ä–µ–º—è**: 15:19 (Almaty)

---

## üìä –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### ‚úÖ Backend API (Port 8014)
- **URL**: http://localhost:8014
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: SQLite (`backend/figma_catalog.db`)
- **Seed –¥–∞–Ω–Ω—ã–µ**:
  - Shop ID: 8
  - Admin: +77015211545 (password: 1234)
  - Products: 5 (4 flowers + 1 sweets)
  - Test client: telegram_user_id=123456789
- **Health**: http://localhost:8014/health ‚Üí `{"status": "healthy"}`

### ‚úÖ MCP HTTP Server (Port 8000)
- **URL**: http://localhost:8000
- **Process**: PID 25696
- **Tools registered**: 37 tools across 7 domains
- **Domains**: auth, products, orders, inventory, telegram, shop, kaspi
- **Health**: http://localhost:8000/health ‚Üí `{"status": "healthy"}`
- **Start command**: `cd mcp-server && .venv/bin/python http_server.py`

### ‚úÖ AI Agent Service (Port 8002)
- **URL**: http://localhost:8002
- **Model**: Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)
- **MCP Server**: Connected to http://localhost:8000
- **Process**: PIDs 22409, 22451 (uvicorn parent/child)
- **Start command**: `cd ai-agent-service && python3 main.py`

### ‚úÖ Telegram Bot (Polling Mode)
- **Mode**: Polling (local development)
- **Token**: TEST_TELEGRAM_TOKEN (8080729458:...)
- **Process**: PID 26273
- **Backend URL**: http://localhost:8014/api/v1
- **AI Agent URL**: http://localhost:8002
- **Polling**: ‚úÖ getUpdates —É—Å–ø–µ—à–Ω–æ –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
- **Start command**: `cd telegram-bot && python3 bot.py`

---

## üéØ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ù–∞–π—Ç–∏ —Ç–µ—Å—Ç-–±–æ—Ç–∞ –≤ Telegram
–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ username —Ç–µ—Å—Ç-–±–æ—Ç–∞ (token: `8080729458:...`)

### 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ù–∞–∂–∞—Ç—å `/start`
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É **"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º"**
- –ë–æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Backend API
- –ö–µ—à –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: 5 –º–∏–Ω—É—Ç

### 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
–ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è AI Agent:

```
–ü–æ–∫–∞–∂–∏ –±—É–∫–µ—Ç—ã
–•–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å —Ä–æ–∑—ã
–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –¥–æ—Å—Ç–∞–≤–∫–∞?
–ö–∞–∫–∏–µ –±—É–∫–µ—Ç—ã –µ—Å—Ç—å –¥–æ 10000 —Ç–µ–Ω–≥–µ?
–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞?
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ AI Agent
- AI Agent –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MCP Server –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Backend API
- AI Agent –≤–µ—Ä–Ω–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ SQLite Database Initialization
**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `init_local_db.sh`
**–ü—Ä–∏—á–∏–Ω–∞**: Models –Ω–µ –±—ã–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–µ—Ä–µ–¥ `SQLModel.metadata.create_all()`
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `import models` –≤ `database.py:44`

### 2. ‚úÖ Circular Dependency User ‚Üî Shop
**–ü—Ä–æ–±–ª–µ–º–∞**: `IntegrityError: NOT NULL constraint failed: shop.owner_id`
**–ü—Ä–∏—á–∏–Ω–∞**: Shop —Ç—Ä–µ–±—É–µ—Ç owner_id (User), User —Ç—Ä–µ–±—É–µ—Ç shop_id (Shop)
**–†–µ—à–µ–Ω–∏–µ**: –ú–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤ `seed_data.py`:
1. –°–æ–∑–¥–∞—Ç—å User –±–µ–∑ shop_id
2. –°–æ–∑–¥–∞—Ç—å Shop —Å owner_id=user.id
3. –û–±–Ω–æ–≤–∏—Ç—å User —Å shop_id=shop.id

### 3. ‚úÖ Password Hash Function
**–ü—Ä–æ–±–ª–µ–º–∞**: `ImportError: cannot import name 'hash_password' from 'utils'`
**–ü—Ä–∏—á–∏–Ω–∞**: –§—É–Ω–∫—Ü–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `get_password_hash` –≤ `auth_utils.py`
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –≤ `seed_data.py:12`

### 4. ‚úÖ ProductType Enum Values
**–ü—Ä–æ–±–ª–µ–º–∞**: `AttributeError: READY` (enum –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è READY)
**–ü—Ä–∏—á–∏–Ω–∞**: ProductType –∏–º–µ–µ—Ç FLOWERS, SWEETS, FRUITS, GIFTS
**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω—ã —Ç–∏–ø—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ FLOWERS –∏ SWEETS

### 5. ‚úÖ MCP Server Transport
**–ü—Ä–æ–±–ª–µ–º–∞**: AI Agent –Ω–µ –º–æ–≥ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MCP Server (Failed to fetch schemas)
**–ü—Ä–∏—á–∏–Ω–∞**: `server.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç stdio transport, AI Agent –æ–∂–∏–¥–∞–µ—Ç HTTP
**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–ø—É—â–µ–Ω `http_server.py` –Ω–∞ –ø–æ—Ä—Ç—É 8000 –≤–º–µ—Å—Ç–æ `server.py`

### 6. ‚úÖ Multiple Bot Instances
**–ü—Ä–æ–±–ª–µ–º–∞**: `Conflict: terminated by other getUpdates request`
**–ü—Ä–∏—á–∏–Ω–∞**: 6 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ bot.py —Ä–∞–±–æ—Ç–∞–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
**–†–µ—à–µ–Ω–∏–µ**: –£–±–∏—Ç—ã –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —á–µ—Ä–µ–∑ `kill -9`, –∑–∞–ø—É—â–µ–Ω –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä

---

## üìÅ –õ–æ–≥–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –õ–æ–≥–∏
- **Backend**: `backend/backend.log`
- **MCP HTTP Server**: `mcp-server/http_server.log`
- **AI Agent**: Console output (Background Bash process)
- **Telegram Bot**: `telegram-bot/bot.log`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- **Backend**: `backend/.env` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ SQLite)
- **MCP Server**: `mcp-server/.env` (API_BASE_URL, DEFAULT_SHOP_ID)
- **AI Agent**: `ai-agent-service/.env` (CLAUDE_API_KEY, MCP_SERVER_URL, PORT)
- **Bot**: `telegram-bot/.env` (TEST_TELEGRAM_TOKEN, BACKEND_API_URL, AI_AGENT_URL)

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

```bash
# Backend API
curl http://localhost:8014/health

# MCP HTTP Server
curl http://localhost:8000/health

# AI Agent Service (–µ—Å–ª–∏ –µ—Å—Ç—å /health endpoint)
curl http://localhost:8002/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep -E "(bot.py|http_server.py|main.py.*ai-agent)" | grep -v grep
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨                            ‚îÇ
‚îÇ                   (Telegram Client)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ Telegram API
                            ‚îÇ (polling mode)
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   TELEGRAM BOT                             ‚îÇ
‚îÇ                   Port: Polling                            ‚îÇ
‚îÇ                   PID: 26273                               ‚îÇ
‚îÇ  - Authorization via Backend API                           ‚îÇ
‚îÇ  - Message processing via AI Agent                         ‚îÇ
‚îÇ  - Phone normalization                                     ‚îÇ
‚îÇ  - Cache (5 min TTL)                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚îÇ POST /chat
                        ‚îÇ (customer message + context)
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   AI AGENT SERVICE                         ‚îÇ
‚îÇ                   Port: 8002                               ‚îÇ
‚îÇ                   PIDs: 22409, 22451                       ‚îÇ
‚îÇ  - Model: Claude Sonnet 4.5                                ‚îÇ
‚îÇ  - Natural language processing                             ‚îÇ
‚îÇ  - Tool use decision making                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚îÇ GET /tools/schema
                        ‚îÇ POST /call-tool
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   MCP HTTP SERVER                          ‚îÇ
‚îÇ                   Port: 8000                               ‚îÇ
‚îÇ                   PID: 25696                               ‚îÇ
‚îÇ  - 37 tools registered                                     ‚îÇ
‚îÇ  - HTTP wrapper over MCP stdio                             ‚îÇ
‚îÇ  - Domains: auth, products, orders, inventory,             ‚îÇ
‚îÇ             telegram, shop, kaspi                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚îÇ REST API calls
                        ‚îÇ (GET, POST, PATCH, etc.)
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   BACKEND API                              ‚îÇ
‚îÇ                   Port: 8014                               ‚îÇ
‚îÇ  - FastAPI + SQLAlchemy                                    ‚îÇ
‚îÇ  - Multi-tenancy via shop_id                               ‚îÇ
‚îÇ  - JWT authentication                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚îÇ SQL queries
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   SQLite DATABASE                          ‚îÇ
‚îÇ                   File: figma_catalog.db                   ‚îÇ
‚îÇ  - 30 tables                                               ‚îÇ
‚îÇ  - Shop ID: 8                                              ‚îÇ
‚îÇ  - 5 products, test client                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –±—É–∫–µ—Ç—ã

```mermaid
sequenceDiagram
    User->>Bot: "–ü–æ–∫–∞–∂–∏ –±—É–∫–µ—Ç—ã"
    Bot->>Backend: GET /telegram/client?user_id=626599
    Backend-->>Bot: Client data (phone, name)
    Bot->>AI Agent: POST /chat {message, client_data}
    AI Agent->>MCP Server: GET /tools/schema
    MCP Server-->>AI Agent: 37 tools available
    AI Agent->>MCP Server: POST /call-tool {name: "list_products"}
    MCP Server->>Backend: GET /api/v1/products?shop_id=8
    Backend-->>MCP Server: [Product1, Product2, ...]
    MCP Server-->>AI Agent: Products JSON
    AI Agent-->>Bot: "–£ –Ω–∞—Å –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –±—É–∫–µ—Ç—ã: 1. –ë—É–∫–µ—Ç —Ä–æ–∑..."
    Bot-->>User: Natural language response
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ end-to-end
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –≤ Telegram
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ (`tail -f telegram-bot/bot.log`)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ AI Agent (Background Bash output)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ MCP Server (`tail -f mcp-server/http_server.log`)
5. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### Production –¥–µ–ø–ª–æ–π (–∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ)
```bash
# Backend
cd backend
railway link  # –≤—ã–±—Ä–∞—Ç—å figma-product-catalog service
railway up --ci

# Frontend Admin
cd frontend
railway link  # –≤—ã–±—Ä–∞—Ç—å Frontend service
railway up --ci

# Telegram Bot
cd telegram-bot
railway link  # –≤—ã–±—Ä–∞—Ç—å telegram-bot service
railway up --ci
```

---

## üéì –ò–Ω—Å–∞–π—Ç—ã –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### –ü–æ—á–µ–º—É HTTP wrapper –¥–ª—è MCP Server?

**Model Context Protocol (MCP)** –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç stdio —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç - –ø—Ä–æ—Ü–µ—Å—Å—ã –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ stdin/stdout. –≠—Ç–æ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ (Claude Desktop, VS Code), –Ω–æ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

**HTTP wrapper (`http_server.py`)** —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É:
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç MCP stdio tools –≤ REST API endpoints
- –ü–æ–∑–≤–æ–ª—è–µ—Ç AI Agent –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –ø–æ —Å–µ—Ç–∏
- –£–ø—Ä–æ—â–∞–µ—Ç –¥–µ–ø–ª–æ–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö (Backend –Ω–∞ –æ–¥–Ω–æ–º, AI Agent –Ω–∞ –¥—Ä—É–≥–æ–º)
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ HTTP-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ (NGINX, load balancers)

### –ó–∞—á–µ–º MCP Server –º–µ–∂–¥—É AI Agent –∏ Backend?

**–ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Backend API** –∏–∑ AI Agent –±—ã–ª –±—ã –ø—Ä–æ—â–µ, –Ω–æ MCP –¥–∞–µ—Ç:
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**: MCP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JSON Schema –¥–ª—è –∫–∞–∂–¥–æ–≥–æ tool
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –û–¥–∏–Ω MCP Server –º–æ–∂–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ AI –∞–≥–µ–Ω—Ç–æ–≤
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –î–æ–º–µ–Ω—ã (auth, products, orders) –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è**: MCP - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª Anthropic –¥–ª—è tool use

### –ü–æ—á–µ–º—É SQLite –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏?

**Production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL**, –Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ SQLite –¥–∞–µ—Ç:
- **Zero setup**: –ù–µ—Ç –Ω—É–∂–¥—ã –≤ Docker, —É—Å—Ç–∞–Ω–æ–≤–∫–µ PostgreSQL
- **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è —Å production
- **–°–∫–æ—Ä–æ—Å—Ç—å**: –ù–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ
- **–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: –§–∞–π–ª `figma_catalog.db` –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —É–¥–∞–ª–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å

**Auto-detection –≤ `database.py:6-9`**:
```python
if os.getenv("DATABASE_URL"):
    from config_render import settings  # PostgreSQL
else:
    from config_sqlite import settings  # SQLite
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã. –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram –±–æ—Ç–∞ —Å AI-powered –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π.

**–í–∞–∂–Ω–æ**: –≠—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Railway –¥–µ–ø–ª–æ–π —Å PostgreSQL.
