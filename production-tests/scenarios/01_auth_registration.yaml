name: "Authentication & Registration Flow"
description: "Тест авторизации и работы с токенами"

environment:
  base_url: "https://figma-product-catalog-production.up.railway.app/api/v1"
  shop_id: 2
  test_manager_phone: "+77777777777"
  test_manager_password: "test123"
  test_manager_name: "API Test User"

test_steps:
  # Step 1: Login with existing user
  - name: "Login with credentials"
    endpoint: "/auth/login"
    method: "POST"
    body:
      phone: "{{test_manager_phone}}"
      password: "{{test_manager_password}}"
    assertions:
      - status_code: 200
      - response.access_token: exists
      - response.user.id: exists
    save:
      access_token: "response.access_token"
      user_id: "response.user.id"

  # Step 2: Get current user info
  - name: "Get current user (/auth/me)"
    endpoint: "/auth/me"
    method: "GET"
    headers:
      Authorization: "Bearer {{access_token}}"
    assertions:
      - status_code: 200
      - response.id: exists
      - response.name: exists
      - response.phone: "{{test_manager_phone}}"

  # Step 3: Verify token
  - name: "Verify token validity"
    endpoint: "/auth/verify-token"
    method: "GET"
    headers:
      Authorization: "Bearer {{access_token}}"
    assertions:
      - status_code: 200
      - response.valid: true

success_criteria:
  - login_successful: true
  - token_valid: true
  - user_profile_accessible: true
