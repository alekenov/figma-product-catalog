# Тестовые сценарии для обогащенных данных товаров

## Обзор

Эти сценарии проверяют использование AI Agent новых полей товаров:
- `colors` - цвета букетов
- `tags` - метки (bestseller, same-day, premium, budget)
- `manufacturingTime` - время изготовления в минутах
- `shelfLife` - срок хранения в днях

## Новые сценарии (38-43)

### 38_search_by_color.yaml
**Цель:** Проверка фильтрации по цвету

**Запрос:** "Хочу заказать красные цветы для любимой"

**Ожидается:**
- AI находит товары с `colors: ["красный"]`
- Рекомендует букет роз
- Использует описания с упоминанием цвета

**Результат:** ✅ PASSED
- AI правильно выделил красные розы
- Использовал обогащенное описание

---

### 39_urgent_quick_bouquet.yaml
**Цель:** Проверка фильтрации по времени изготовления

**Запрос:** "Какой букет можете сделать за 15 минут максимум?"

**Ожидается:**
- AI анализирует поле `manufacturingTime`
- Предлагает ромашки (10 мин) и тюльпаны (15 мин)
- НЕ предлагает букет невесты (60 мин)

**Результат:** ✅ PASSED
- AI правильно отсортировал по времени
- Предупредил про долгое изготовление букета невесты

---

### 40_long_shelf_life.yaml
**Цель:** Проверка фильтрации по сроку хранения

**Запрос:** "Какие цветы простоят дольше всех?"

**Ожидается:**
- AI анализирует поле `shelfLife`
- Рекомендует розы и ромашки (7 дней)
- Упоминает более короткий срок у тюльпанов (5 дней)

**Результат:** ✅ PASSED
- AI правильно сравнил сроки хранения
- Дал корректные рекомендации

---

### 41_bestseller_request.yaml
**Цель:** Проверка использования тега "bestseller"

**Запрос:** "Что у вас обычно покупают?"

**Ожидается:**
- AI фильтрует товары с тегом `bestseller`
- Выделяет розы и Raffaello
- Объясняет популярность

**Результат:** ✅ PASSED
- AI показал бестселлеры
- Корректно использовал теги

---

### 42_same_day_delivery.yaml
**Цель:** Проверка использования тега "same-day"

**Запрос:** "Что можете доставить сегодня?"

**Ожидается:**
- AI фильтрует товары с тегом `same-day`
- Показывает розы, тюльпаны, ромашки
- НЕ показывает букет невесты (нет тега same-day)

**Результат:** ✅ PASSED
- AI показал товары с быстрой доставкой
- Использовал теги для фильтрации

---

### 43_white_flowers_wedding.yaml
**Цель:** Комбинированная проверка (цвет + тег premium)

**Запрос:** "Белые цветы для свадьбы - элегантное"

**Ожидается:**
- AI фильтрует по `colors: ["белый"]`
- Учитывает тег `premium` для свадьбы
- Рекомендует букет невесты

**Результат:** ✅ PASSED
- AI правильно сочетал фильтры
- Предложил премиум букет + бюджетную альтернативу

---

## Статистика

- **Всего сценариев:** 6
- **Успешных:** 6 (100%)
- **Среднее время ответа:** 14.7 секунд
- **Стоимость 1 запроса:** ~$0.012

## Как запустить

### Отдельный сценарий:
```bash
cd testing-framework
./run_test.sh scenarios/38_search_by_color.yaml
```

### Все новые сценарии:
```bash
for i in {38..43}; do
  ./run_test.sh scenarios/${i}_*.yaml
done
```

### Быстрый тест через curl:
```bash
curl -X POST http://localhost:8002/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Покажи красные цветы",
    "user_id": "test-user",
    "channel": "test"
  }'
```

## Требования

- ✅ Backend API запущен (http://localhost:8014)
- ✅ MCP Server запущен (http://localhost:8000)
- ✅ AI Agent Service запущен (http://localhost:8002)
- ✅ База данных содержит обогащенные данные

## Обогащенные данные

Скрипт для заполнения данных:
```bash
cd backend
python3 scripts/update_products_data.py
```

Проверка данных через API:
```bash
curl "http://localhost:8014/api/v1/products/1?shop_id=8" | jq '.colors, .tags, .manufacturingTime, .shelfLife'
```

---

**Дата создания:** 2025-10-16
**Автор:** Claude Code
**Версия:** 1.0
