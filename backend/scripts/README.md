# Backend Utility Scripts

–≠—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üìä Database Utilities

### `check_production_db.py`
–ü—Ä–æ–≤–µ—Ä–∫–∞ production –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Railway.
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ production PostgreSQL
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü, –∑–∞–ø–∏—Å–µ–π
- –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
cd backend
python3 scripts/check_production_db.py
```

### `check_production_users.py`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ production –ë–î.
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –†–æ–ª–∏ –∏ shop_id
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### `analyze_shops.py`
–ê–Ω–∞–ª–∏–∑ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∏ –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö shops
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–∫–∞–∑–∞–º –∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º

---

## üí≥ Payment Utilities

### `check_all_payments.py`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π Kaspi Pay.
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π –≤ –ë–î
- –°–≤–µ—Ä–∫–∞ —Å Kaspi API
- –ü–æ–∏—Å–∫ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π

### `check_kaspi_payments.py`
–î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π Kaspi.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ payment –ø–æ ID
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –õ–æ–≥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### `manual_check_and_refund.py`
–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –ø–ª–∞—Ç–µ–∂–µ–π.
- –ü–æ–∏—Å–∫ –ø–ª–∞—Ç–µ–∂–∞ –ø–æ tracking_id
- –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ Kaspi API
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–æ–∑–≤—Ä–∞—Ç–∞

---

## üß™ Testing Utilities

### `create_test_user.py`
–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é DIRECTOR
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å
- –í—ã–≤–æ–¥–∏—Ç —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
python3 scripts/create_test_user.py
```

### `create_test_product.py`
–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞.
- –°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ù–∞–∑–Ω–∞—á–∞–µ—Ç shop_id
- –î–æ–±–∞–≤–ª—è–µ—Ç warehouse item

---

## üóëÔ∏è Maintenance Utilities

### `cleanup_expired_reservations.py`
–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤.
- –ù–∞—Ö–æ–¥–∏—Ç —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ä—à–µ 15 –º–∏–Ω—É—Ç
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∫ cron job –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç

**Cron –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**:
```bash
*/10 * * * * cd /path/to/backend && python3 scripts/cleanup_expired_reservations.py
```

### `delete_product.py`
–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–∑ –ë–î (—á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π SQL).
- –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –ø–æ ID
- –ö–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
- **–û—Å—Ç–æ—Ä–æ–∂–Ω–æ**: –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

### `delete_product_api.py`
–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —á–µ—Ä–µ–∑ API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç DELETE /api/v1/products/{id}
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —á–µ–º –ø—Ä—è–º–æ–π SQL

---

## üîê Security & Auth

### `get_token.py`
–ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API.
- –õ–æ–≥–∏–Ω —á–µ—Ä–µ–∑ /api/v1/auth/login
- –í—ã–≤–æ–¥–∏—Ç access_token
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è curl/Postman —Ç–µ—Å—Ç–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
python3 scripts/get_token.py +77015211545 1234
```

### `fix_admin_password.py`
–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
- –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ phone
- –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ä–æ–ª—å –Ω–∞ –Ω–æ–≤—ã–π
- –•–µ—à–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ bcrypt

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
python3 scripts/fix_admin_password.py +77015211545 new_password_123
```

---

## üõ†Ô∏è Data Fixes

### `fix_local_db_enums.py`
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ enum –∑–Ω–∞—á–µ–Ω–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î.
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç lowercase ‚Üí UPPERCASE –¥–ª—è OrderStatus
- –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç 'new' ‚Üí 'NEW', 'paid' ‚Üí 'PAID' –∏ —Ç.–¥.
- –ó–∞–ø—É—Å–∫–∞—Ç—å –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ legacy –¥–∞–Ω–Ω—ã—Ö

### `check_order_api.py`
–ü—Ä–æ–≤–µ—Ä–∫–∞ API –∑–∞–∫–∞–∑–æ–≤.
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ endpoints orders API
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤

---

## üè™ Initialization Scripts

### `init_recipes.py`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤.
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã –∏–∑ JSON/CSV
- –°–≤—è–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç—ã —Å warehouse items
- –°–æ–∑–¥–∞–µ—Ç Recipe –∑–∞–ø–∏—Å–∏

### `init_warehouse.py`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–ª–∞–¥–∞.
- –°–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ warehouse items
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–Ω–∏–º—É–º—ã

---

## ‚ö†Ô∏è Important Notes

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å** —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞ production –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
- –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å backup –ë–î –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å shop_id –¥–ª—è multi-tenancy isolation

### –û–∫—Ä—É–∂–µ–Ω–∏—è
–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `DATABASE_URL` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- `SECRET_KEY` - JWT —Å–µ–∫—Ä–µ—Ç
- `KASPI_API_BASE_URL` - Kaspi Pay endpoint
- `KASPI_ACCESS_TOKEN` - Kaspi API —Ç–æ–∫–µ–Ω

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–°–∫—Ä–∏–ø—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç –≤ stdout. –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤:
```bash
python3 scripts/script_name.py >> logs/script.log 2>&1
```

---

## üìù Contributing

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞:
1. –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —ç—Ç–æ—Ç README
2. –î–æ–±–∞–≤–∏—Ç—å docstring –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `if __name__ == "__main__":` –¥–ª—è –∑–∞–ø—É—Å–∫–∞
4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ gracefully

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 23 –æ–∫—Ç—è–±—Ä—è 2025
